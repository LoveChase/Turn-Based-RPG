
<!DOCTYPE html><html lang='en' class=''>
        <head><script src='//static.codepen.io/assets/editor/live/console_runner-ce3034e6bde3912cc25f83cccb7caa2b0f976196f2f2d52303a462c826d54a73.js'></script><script src='//static.codepen.io/assets/editor/live/css_reload-2a5c7ad0fe826f66e054c6020c99c1e1c63210256b6ba07eb41d7a4cb0d0adab.js'></script><meta charset='UTF-8'><meta name="robots" content="noindex"><link rel="shortcut icon" type="image/x-icon" href="//static.codepen.io/assets/favicon/favicon-8ea04875e70c4b0bb41da869e81236e54394d63638a1ef12fa558a4a835f1164.ico" /><link rel="mask-icon" type="" href="//static.codepen.io/assets/favicon/logo-pin-f2d2b6d2c61838f7e76325261b7195c27224080bc099486ddd6dccb469b8e8e6.svg" color="#111" /><link rel="canonical" href="https://codepen.io/ChaseLove/pen/OaNrZJ" />
        
        <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.css'><link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-beta.2/css/bootstrap.css'>
        <style class="cp-pen-styles">body {
          background-color: #001427;
          color: white;
        }
        
        #playtest, .ui-widget-content {
          border: 1px solid white;
          background-color: #000016;
          background-image: url(https://www.konami.com/yugioh/duel_links/images/common/bk_layer_a.png);
          background-size: cover;
          width: 750px;
          margin: 0 auto;
          padding: 1rem;
        }
        
        #playtest {
          position: relative;
        }
        
        #play {
          cursor: pointer;
        }
        
        .ui-widget-header {
          border: none;
          background-color: transparent;
          color: #e9e9e9;
        }
        
        #deckmenu {
          margin: 1rem;
        }
        
        #playerdeck, #deckmenu img {
          cursor: pointer;
        }
        
        #playerextradeck img {
          cursor: pointer;
        }
        
        #hand {
          flex-wrap: wrap;
          width: 600px;
          display: flex;
          align-items: center;
        }
        
        .deck {
          width: 59px;
          height: 86px;
          position: relative;
          background-image: url("http://img3.wikia.nocookie.net/__cb20130902115200/yugioh/images/e/ee/Back-ZX-Site.png");
          background-size: 100%;
          cursor: pointer;
          top: 175px;
          left: 472px;
        }
        
        #playmat img {
          width: 500px;
          height: auto;
        }
        
        #playtest .actions {
          text-align: center;
        }
        #playtest .actions input {
          margin: 1rem 0;
        }
        
        .game-board {
          display: inline-block;
        }
        .game-board .testcard-slot-row {
          margin-top: 20px;
          margin-bottom: 20px;
          clear: both;
          display: flex;
        }
        .game-board .testcard-slot-row .testcard-slot, .game-board .testcard-slot-row .hand, .game-board .testcard-slot-row .field {
          border: 1px solid white;
          border-radius: 4px;
          margin-left: 15px;
          margin-right: 15px;
          height: 102px;
          width: 70px;
          float: left;
        }
        .game-board .testcard-slot-row .testcard-slot img, .game-board .testcard-slot-row .hand img, .game-board .testcard-slot-row .field img {
          width: 100%;
        }
        .game-board .testcard-slot-row .testcard-slot img.rotated, .game-board .testcard-slot-row .hand img.rotated, .game-board .testcard-slot-row .field img.rotated {
          transform: rotate(270deg);
        }
        .game-board .testcard-slot-row .testcard-slot:first-child, .game-board .testcard-slot-row .hand:first-child, .game-board .testcard-slot-row .field:first-child {
          border-radius: 0px;
        }
        .game-board .testcard-slot-row .testcard-slot:last-child, .game-board .testcard-slot-row .hand:last-child, .game-board .testcard-slot-row .field:last-child {
          border-radius: 0px;
        }
        .game-board .stats .tools {
          height: 60px;
          display: flex;
          justify-content: center;
          align-items: center;
        }
        .game-board .stats .tools .token, .game-board .stats .tools .coin, .game-board .stats .tools .dice {
          width: 25px;
          margin-right: 5px;
          cursor: pointer;
          z-index: 99;
        }
        
        #results {
          position: relative;
          left: 25px;
        }
        </style></head><body>
        <div class="text-center">
                <a style='margin: 1rem 0;' id="play" class='btn btn-success' role='button'><i class='fa fa-play-circle' aria-hidden='true'></i> Play Test Deck</a>
                <div id="playtest" title="Playtest Beta">
                    <div class="game-board">
                        <div class="actions">
                            <input type="button" value="Import" id="import">
                            <input type="button" value="Export" id="export">
                            <input type="button" value="New Hand" id="new">
                            <input type="button" value="View Deck" id="view">
                            <input type="button" value="Draw Card" id="deal">
                            <input type="button" value="Shuffle Deck" id="shuffle">
                            <div class="tools">
                                <img src="https://i.imgur.com/BYD9LdN.png" class="token"/>
                                <img src="https://i.imgur.com/1AJdr5l.png" alt="" class="coin">
                                <img src="https://i.imgur.com/oPHhyyo.png" alt="" class="dice">
                                <div style="display:inline-block"><span id="results"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADwAAAABCAQAAAAoEQWKAAAADElEQVR42mNkGCAAAADyAAKG+BtxAAAAAElFTkSuQmCC"></span></div>
                            </div>
                        </div>
                        <div id="deckmenu" title="Cards in Deck"></div>
                        <div class="testcard-slot-row" id="field">
                            <div class="testcard-slot"></div>
                            <div class="testcard-slot"></div>
                            <div class="testcard-slot" id="center-m-z"></div>
                            <div class="testcard-slot"></div>
                            <div class="testcard-slot"></div>
                        </div>
                        <div class="testcard-slot-row">
                            <div class="testcard-slot"><img src="http://img3.wikia.nocookie.net/__cb20130902115200/yugioh/images/e/ee/Back-ZX-Site.png" id="playerextradeck" />
                                <div id="deckcount"><p></p></div>
                            </div>
                            <div class="testcard-slot"></div>
                            <div class="testcard-slot"></div>
                            <div class="testcard-slot"></div>
                            <div class="testcard-slot"><img src="http://img3.wikia.nocookie.net/__cb20130902115200/yugioh/images/e/ee/Back-ZX-Site.png" id="playerdeck" />
                                <div id="deckcount"><p></p></div>
                            </div>
                        </div>
                        <div id="hand">
                            <div class="game-board"></div>
                        </div>
                        <div class="export" title="Export Code"></div>
                        <div class="import" title="Import Code"></div>
                    </div>          
                </div>
            </div>
        <script src='//static.codepen.io/assets/common/stopExecutionOnTimeout-41c52890748cd7143004e05d3c5f786c66b19939c4500ce446314d1748483e13.js'></script><script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js'></script><script src='https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js'></script><script src='https://cdnjs.cloudflare.com/ajax/libs/jqueryui-touch-punch/0.2.3/jquery.ui.touch-punch.min.js'></script>
        <script >var playtest = { "name": "420 Hazyyyyy", "author": "DBGxOsO", "created": "2018-01-18", "skill": "Beatdown!", "main": [{ "name": "Hazy Flame Cerbereus", "amount": 1 }, { "name": "Hazy Flame Cerbereus", "amount": 1 }, { "name": "Hazy Flame Cerbereus", "amount": 1 }, { "name": "Hazy Flame Sphynx", "amount": 1 }, { "name": "Hazy Flame Sphynx", "amount": 1 }, { "name": "Hazy Flame Sphynx", "amount": 1 }, { "name": "Chow Len the Prophet", "amount": 1 }, { "name": "Earth Armor Ninja", "amount": 1 }, { "name": "Earth Armor Ninja", "amount": 1 }, { "name": "Earth Armor Ninja", "amount": 1 }, { "name": "Hazy Flame Peryton", "amount": 1 }, { "name": "Hazy Flame Peryton", "amount": 1 }, { "name": "Hazy Flame Peryton", "amount": 1 }, { "name": "Sphere Kuriboh", "amount": 1 }, { "name": "Anti-Magic Arrows", "amount": 1 }, { "name": "Anti-Magic Arrows", "amount": 1 }, { "name": "Anti-Magic Arrows", "amount": 1 }, { "name": "Mausoleum of the Emperor", "amount": 1 }, { "name": "Mausoleum of the Emperor", "amount": 1 }, { "name": "Mausoleum of the Emperor", "amount": 1 }], "extra": [], "notes": [{ "text": "First time KOG. Been playing since day one. Used a Phoenix build for most of my climb the. Switched to this in legend." }], "url": "/top-decks/january-2018/hazy-flame-br/420-hazyyyyy-by-dbgxoso/" };
        
        $('#play').click(function () {
          $('#playtest').show();
        });
        
        $(function () {
          $('#playtest').hide();
        });
        
        let decklist = [];
        let extradecklist = [];
        let hand = [];
        let board = [];
        let currentDeck = joinMainExtraDeck(playtest.main, playtest.extra);
        
        let encode = window.btoa(JSON.stringify(getExportReadyDeck(currentDeck)));
        
        $('#export').click(function () {
          $('.export').html(`<textarea style="width:320px" class="code">${encode}</textarea>`);
          $('.export').dialog({
            width: 388,
            open: function (event, ui) {
              $(this).closest(".ui-dialog").
              find(".ui-dialog-titlebar-close").
              removeClass("ui-dialog-titlebar-close").
              html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");
            } });
        
        });
        
        $('#import').click(function () {
          $('.import').html(`<textarea style="width:320px" class="codeimport"></textarea><input type="button" value="Submit" id="submitdeck">`);
          $('.import').dialog({
            width: 388,
            open: function (event, ui) {
              $(this).closest(".ui-dialog").
              find(".ui-dialog-titlebar-close").
              removeClass("ui-dialog-titlebar-close").
              html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");
            } });
        
        });
        
        $(document).on("click", "#submitdeck", function () {
          $('.import').dialog("close");
          let code = window.atob($('.codeimport').val());
          importDeck(JSON.parse(code));
        });
        
        $(document).on("click", ".code", function () {
          $(this).select();
          document.execCommand("Copy");
        });
        
        $(document).on("click", "#deckmenu img", function () {
          let id = $(this).attr('id');
        
          let positionInMain = getCardPositionInArray(decklist, id);
        
          if (positionInMain >= 0) {// monster is in the main deck
            dealCard(positionInMain);
          } else {// monster is in the extra deck
            summonMonsterFromExtra(getCardPositionInArray(extradecklist, id));
          }
        });
        
        function getExportReadyDeck(currentDeck) {
          var joined = [];
        
          for (let card in currentDeck) {
            let found = false;
            for (let joinedCard in joined) {
              if (joined[joinedCard].name == currentDeck[card].name) {
                joined[joinedCard].amount++;
                found = true;
                break;
              }
            }
        
            if (!found) {
              joined.push({
                name: currentDeck[card].name,
                deck: currentDeck[card].deck,
                amount: 1 });
        
            }
          }
        
          return joined;
        }
        
        function joinMainExtraDeck(main, extra) {
          var joined = [];
        
          let id = 0;
        
          for (let card in main) {
            joined.push({
              name: main[card].name,
              deck: 0,
              amount: main[card].amount });
        
          }
        
          for (let card in extra) {
            joined.push({
              name: extra[card].name,
              deck: 1,
              amount: extra[card].amount });
        
          }
        
          return joined;
        }
        
        function importDeck(deck) {
          refreshDeck(deck);
          shuffleDeck(decklist);
          $('#hand').empty();
          handleSkill(Phase.DRAW);
          if ($('#deckmenu').dialog('isOpen')) {
            openDeck(deck);
          }
          currentDeck = deck;
        }
        
        /*
           * This is the starting function for the playtest area.
           * Marking this for future reference. 
           */
        $(function () {
          refreshDeck(currentDeck);
          shuffleDeck(decklist);
          $('#hand').empty();
          handleSkill(Phase.DRAW);
        });
        
        /*
             * The object 'Phase' represents the time in which a skill needs to occur.
             * 
             * There are several representations:
             * -- DRAW: The opening hand is modified in some way BEFORE the duel begins (i.e. start with Harpies' Hunting Ground, start with 5 card [Duel, Standby], etc.) 
             * -- STANDBY: The field is manipulated in some way BEFORE the duel begins (i.e. start with Ojama Country, start with monsters on the field [Elements Unite], etc.)
             * -- MAIN: Anything after the beginning of the duel is manipuated (i.e. draw the same card twice [Extra, Extra], etc.)     
             */
        let Phase = {};
        Phase.DRAW = "Draw Phase";
        Phase.STANDBY = "Standby Phase";
        Phase.MAIN = "Main Phase";
        
        function handleSkill(phase) {
          switch (phase) {
            case Phase.DRAW:
              switch (playtest.skill) {
                case "Harpies' Hunting Ground":
                  decklist.push({ id: decklist.length, name: "Harpies' Hunting Ground" });
                  dealHand(decklist.length - 1);
        
                  for (var i = 0; i < 3; i++) {if (window.CP.shouldStopExecution(0)) break;
                    dealHand(randomCard());
                  }window.CP.exitedLoop(0);
        
                  break;
                default:
                  for (var i = 0; i < 4; i++) {if (window.CP.shouldStopExecution(1)) break;
                    dealHand(randomCard());
                  }window.CP.exitedLoop(1);}
        
              break;
            default:
              console.error("The following phase has not been defined: " + phase);}
        
        }
        
        $(document).on("click", ".hand img", function () {
          let currentImage = $(this).attr('src');
          if ($(this).hasClass('rotated')) {
            $(this).removeClass('rotated');
          } else {
            $(this).addClass('rotated');
          }
        });
        
        $('#shuffle').click(function () {
          if (decklist == 0) return;
          $('#playerdeck').effect("shake", {
            distance: "5" });
        
          shuffleDeck(decklist);
          if ($('#deckmenu').dialog('isOpen')) {
            openDeck(currentDeck);
          }
        });
        
        $('#view').click(function () {
          openDeck(currentDeck);
        });
        
        $('#playerdeck, #deal').click(function () {
          dealCard(0);
        });
        
        $('#playerextradeck').click(function () {
          openDeck(currentDeck, true);
        });
        
        $('#new').click(function () {
          importDeck(currentDeck);
          $('.tokencopy').remove();
          $('#hand').empty();
          handleSkill(Phase.DRAW);
          if ($('#deckmenu').dialog('isOpen')) {
            openDeck(currentDeck);
          }
        });
        
        function openDeck(deck, extra = false) {
          if (hand.length == 0) {
            refreshDeck(deck);
          }
        
          if ((extra ? extradecklist : decklist) == 0) return;
        
          $('#deckmenu').empty();
        
          /* There's an issue (possibly within JQuery-UI) with the dialog opening without 
                                   * a reference to the top of the #playlist div; initializing 
                                   * the dialog once addresses this 
                                   */
          if (!$('#deckmenu').dialog('instance')) {
            $('#deckmenu').dialog({ autoOpen: false });
          }
        
          for (i in extra ? extradecklist : decklist) {
            if (extra)
            $('#deckmenu').append(`<img style="margin: 1px" src="https://yugiohprices.com/api/card_image/${extradecklist[i].name}" width="60px" id="${extradecklist[i].id}"/>`);else
        
            $('#deckmenu').append(`<img style="margin: 1px" src="https://yugiohprices.com/api/card_image/${decklist[i].name}" width="60px" id="${decklist[i].id}"/>`);
          }
        
          $('#deckmenu').dialog({
            width: 450,
            height: 563,
            resizable: false,
            draggable: true,
            autoOpen: true,
            open: function (event, ui) {
              $(this).closest(".ui-dialog").
              find(".ui-dialog-titlebar-close").
              removeClass("ui-dialog-titlebar-close").
              html("<span class='ui-button-icon-primary ui-icon ui-icon-closethick'></span>");
            },
            position: {
              my: "top top",
              at: "top",
              of: '#playtest' } });
        
        
        }
        
        function randomCard() {
          return Math.floor(Math.random() * decklist.length);
        }
        
        function dealHand(i) {
          addCardToHandDiv(i, 0);
        
          addHand(decklist[i].name, decklist[i].id);
        
          removeCard(i);
        }
        
        function dealCard(i) {
          if (decklist == 0) return;
        
          addCardToHandDiv(i, 0);
        
          addHand(decklist[i].name, decklist[i].id);
        
          removeCard(i);
        
          if ($('#deckmenu').dialog('isOpen')) {
            if (decklist == 0) {
              $('#deckmenu').dialog("close");
            }
            openDeck(currentDeck);
          }
        }
        
        function summonMonsterFromExtra(i) {
          if (extradecklist > 0) return;
        
          $("#source").appendTo("#destination");
        
          addCardToHandDiv(i, 1);
          addHand(extradecklist[i].name, extradecklist[i].id);
        
          var destination = $('#playerextradeck').position();
          $('#cardId' + extradecklist[i].id).css({
            top: destination.top,
            left: destination.left,
            position: 'absolute' });
        
        
          var animDest = $('#center-m-z').position();
          $('#cardId' + extradecklist[i].id).animate({
            top: animDest.top - 20,
            left: animDest.left },
          500);
        
          removeCardFromExtra(i);
          removeCard(i);
        }
        
        function addCardToHandDiv(i, extra) {
          if (extra == 0)
          $('#hand').append(`<div id="cardId${decklist[i].id}" class="testcard-slot-row"><div class="hand cardMain${decklist[i].id}"><img id="${decklist[i].id}" src="https://yugiohprices.com/api/card_image/${decklist[i].name}" /></div>`);else
          if (extra == 1)
          $('#hand').append(`<div id="cardId${extradecklist[i].id}" class="testcard-slot-row"><div class="hand cardEx${extradecklist[i].id}"><img id="${extradecklist[i].id}" src="https://yugiohprices.com/api/card_image/${extradecklist[i].name}" /></div>`);
        
          let nameDom = extra == 1 ? '.cardEx' + extradecklist[i].id : '.cardMain' + decklist[i].id;
        
          $(nameDom).css('border', 'none');
          $(nameDom).draggable({
            snap: '.testcard-slot',
            snapMode: 'inner',
            snapTolerance: '22',
            stack: '.hand',
            stop: function () {
              snappedEvent($(this), extra, snappedToDeck);
            } });
        
        }
        
        function addHand(i, id) {
          hand.push({
            id: id,
            name: i,
            moved: false });
        
        }
        
        function shuffleDeck(a) {
          for (let i = a.length - 1; i > 0; i--) {if (window.CP.shouldStopExecution(2)) break;
            const j = Math.floor(Math.random() * (i + 1));
            [a[i], a[j]] = [a[j], a[i]];
          }window.CP.exitedLoop(2);
        }
        
        function snappedEvent(cardDOM, extra, event) {
          var draggable = cardDOM.data("ui-draggable");
          $.each(draggable.snapElements, function (index, element) {
            if (element.snapping) {
              var snapped = draggable.snapElements;
        
              var snappedTo = $.map(snapped, function (element) {
                return element.snapping ? element.item : null;
              });
        
              let snapToId = extra == true ? 'playerextradeck' : 'playerdeck';
        
              let cardIdInHand = getCardPositionInArray(hand, Number(cardDOM.children().first().attr('id')));
              hand[cardIdInHand].moved = true;
        
              refreshHand();
        
              $.each(snappedTo, function (idx, item) {
                if ($(item).children().first().attr('id') == snapToId) {
                  event(cardDOM, extra);
                }
              });
        
              return false;
            }
          });
        }
        
        function snappedToDeck(cardDOM, extra) {
          let cardId = cardDOM.children().first().attr('id');
        
          if (extra)
          addCardToExtraDeck(cardId);else
        
          addCardToDeck(cardId);
        
          removeCardFromHand(cardId);
        
          if ($('#deckmenu').dialog('isOpen')) {
            openDeck(currentDeck, extra);
          }
        
          return false;
        }
        
        function refreshHand() {
          for (i in hand) {
            if (Boolean(hand[i].moved)) {
              let pos = $('#cardId' + hand[i].id).position();
              $('#hand').append($('#cardId' + hand[i].id));
              $('#cardId' + hand[i].id).css({
                top: pos.top,
                left: pos.left,
                position: 'absolute' });
        
            }
          }
        }
        
        function removeCard(c) {
          decklist.splice(c, 1);
        }
        
        function removeCardFromExtra(c) {
          extradecklist.splice(c, 1);
        }
        
        function getCardPositionInArray(arr, cardId) {
          let index = -1;
        
          arr.forEach(function (element, i) {
            if (element.id == cardId) index = i;
          });
        
          return index;
        }
        
        function addCardToDeck(c) {
          let cardIndexInHand = getCardPositionInArray(hand, c);
        
          decklist.push({
            id: hand[cardIndexInHand].id,
            name: hand[cardIndexInHand].name });
        
        }
        
        function addCardToExtraDeck(c) {
          let cardIndexInHand = getCardPositionInArray(hand, c);
        
          extradecklist.push({
            id: hand[cardIndexInHand].id,
            name: hand[cardIndexInHand].name });
        
        }
        
        function removeCardFromHand(c) {
          let cardIndexInHand = getCardPositionInArray(hand, c);
        
          $('#hand').find('#cardId' + c).remove();
        
          hand.splice(cardIndexInHand, 1);
        }
        
        function refreshDeck(deck) {
          if (deck.length > 0) {
            decklist = [];
            extradecklist = [];
            hand = [];
          }
        
          let id = 0;
        
          for (let i in deck) {
            for (let j = 0; j < Number(deck[i].amount); j++) {if (window.CP.shouldStopExecution(3)) break;
              if (deck[i].deck == 0) {
                decklist.push({
                  id: id,
                  name: deck[i].name });
        
              } else if (deck[i].deck == 1) {
                extradecklist.push({
                  id: id,
                  name: deck[i].name });
        
              }
        
              id++;
            }window.CP.exitedLoop(3);
          }
        
          shuffleDeck(decklist);
        
          $(function () {
            $('#deckcount span').text(decklist.length);
          });
        }
        
        $('.token').draggable({
          helper: 'clone',
          snap: '.testcard-slot',
          snapMode: 'center',
          snapTolerance: '22',
          stack: '.hand' });
        
        $('.token').bind('dragstop', function (event, ui) {
          $(this).after($(ui.helper).clone().draggable().addClass('tokencopy'));
        });
        
        $('.dice').click(function () {
          let die = [];
          die[0] = 'https://i.imgur.com/kp4VvpW.png';
          die[1] = 'https://i.imgur.com/zsG76hB.png';
          die[2] = 'https://i.imgur.com/3LJiXtf.png';
          die[3] = 'https://i.imgur.com/Ngbnkkv.png';
          die[4] = 'https://i.imgur.com/lwEpMt6.png';
          die[5] = 'https://i.imgur.com/4TZwH9q.png';
          let output;
          let faceValue = Math.floor(Math.random() * 6);
          $('#results').hide().html(`<img width="60px" src=${die[faceValue]} />`).fadeIn();
        });
        
        $('.coin').click(function () {
          return Math.floor(Math.random() * 2) == 0 ? $('#results').hide().html(`<img width="60px" src="https://i.imgur.com/1AJdr5l.png"/>`).fadeIn() : $('#results').hide().html(`<img width="60px" src="https://i.imgur.com/N2dFEVu.png"/>`).fadeIn();
        });
        
        $(document).on("click", ".tokencopy", function () {
          $(this).remove();
        });
        //# sourceURL=pen.js
        </script>
        </body></html>